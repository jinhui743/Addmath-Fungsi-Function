<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高级数学 Fungsi Function 测验</title>
    
    <!-- Pako GZIP Compression Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>

    <!-- MathJax Configuration -->
    <script>
        MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
          },
          svg: {
            fontCache: 'global'
          }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>

    <style>
        :root {
            --primary-color: #0056b3;
            --primary-light: #4a90e2;
            --secondary-color: #f7f9fc;
            --text-color: #333;
            --correct-color: #28a745;
            --incorrect-color: #dc3545;
            --white-color: #ffffff;
            --border-radius: 10px;
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: var(--white-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        .page-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: var(--white-color);
            padding: 20px;
            text-align: center;
        }

        .page-header h1 {
            margin: 0;
            font-size: 1.2em;
            font-weight: 500;
        }

        .page-header h2 {
            margin: 5px 0 0;
            font-size: 1.8em;
            font-weight: 700;
        }
        
        .section-content {
            padding: 30px;
        }
        
        /* Student Info Section */
        #student-info .form-group {
            margin-bottom: 20px;
        }

        #student-info label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
        }

        #student-info input, #student-info select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1em;
        }

        /* Quiz Section */
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: 600;
        }

        #question-container {
            margin-bottom: 20px;
            font-size: 1.4em;
            line-height: 1.6;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .option-btn {
            display: block;
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            text-align: left;
            background-color: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option-btn:hover {
            background-color: #e0e0e0;
            border-color: var(--primary-light);
        }
        
        .option-btn.correct {
            background-color: #d4edda;
            border-color: var(--correct-color);
            color: var(--correct-color);
            font-weight: bold;
        }

        .option-btn.incorrect {
            background-color: #f8d7da;
            border-color: var(--incorrect-color);
            color: var(--incorrect-color);
            font-weight: bold;
        }
        
        .option-btn.disabled {
            pointer-events: none;
            opacity: 0.9;
        }

        #feedback {
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
        }

        /* Report Section */
        #report-section .report-header {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            margin-bottom: 20px;
        }

        #report-section .logo {
            width: 80px;
            height: 80px;
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
        }

        #report-section .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            text-align: center;
            margin-bottom: 30px;
        }

        .summary-item {
            background-color: #f7f9fc;
            padding: 20px;
            border-radius: var(--border-radius);
        }

        .summary-item h3 {
            margin: 0 0 10px;
            font-size: 1.1em;
            color: var(--primary-color);
        }

        .summary-item p {
            margin: 0;
            font-size: 1.8em;
            font-weight: 700;
        }

        .review-item {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .review-item p {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .review-item .your-answer.correct {
            color: var(--correct-color);
        }
        
        .review-item .your-answer.incorrect {
            color: var(--incorrect-color);
        }
        
        .review-item .correct-answer {
            color: var(--correct-color);
        }

        #share-section {
            margin-top: 30px;
            text-align: center;
        }
        
        #share-link {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-top: 10px;
            box-sizing: border-box;
        }
        
        .button {
            display: inline-block;
            background-color: var(--primary-color);
            color: var(--white-color);
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: 600;
            text-align: center;
            transition: background-color 0.3s ease;
            width: 100%;
            box-sizing: border-box;
            margin-top: 10px;
        }

        .button:hover {
            background-color: var(--primary-light);
        }
        
        .hidden {
            display: none;
        }
        
        @media (min-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

    </style>
</head>
<body>

    <div class="container">
        
        <!-- Student Info Section -->
        <section id="student-info">
            <div class="page-header">
                <h1>学品教育学院</h1>
                <h2>高级数学 Fungsi Function</h2>
            </div>
            <div class="section-content">
                <div class="form-group">
                    <label for="student-name">学生姓名 (Student Name):</label>
                    <input type="text" id="student-name" name="student-name" required>
                </div>
                <div class="form-group">
                    <label for="student-branch">分院 (Branch):</label>
                    <select id="student-branch" name="student-branch" required>
                        <option value="">请选择分院</option>
                        <option value="Balakong">Balakong</option>
                        <option value="Cheras">Cheras</option>
                        <option value="Kajang">Kajang</option>
                        <option value="Mahkota Cheras">Mahkota Cheras</option>
                        <option value="Puchong">Puchong</option>
                        <option value="Sri Petaling">Sri Petaling</option>
                        <option value="USJ">USJ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="student-level">年级 (Grade):</label>
                    <select id="student-level" name="student-level" required>
                        <option value="">请选择年级</option>
                        <option value="Form 1">Form 1</option>
                        <option value="Form 2">Form 2</option>
                        <option value="Form 3">Form 3</option>
                        <option value="Form 4">Form 4</option>
                        <option value="Form 5">Form 5</option>
                    </select>
                </div>
                <button class="button" onclick="startQuiz()">开始测验 (Start Quiz)</button>
            </div>
        </section>

        <!-- Quiz Section -->
        <section id="quiz-section" class="hidden">
            <div class="page-header">
                <h1>学品教育学院</h1>
                <h2>高级数学 Fungsi Function</h2>
            </div>
            <div class="section-content">
                <div class="quiz-header">
                    <div id="question-counter"></div>
                    <div id="timer">00:00</div>
                </div>
                <div id="question-container"></div>
                <div id="options-grid" class="options-grid"></div>
                <div id="feedback"></div>
            </div>
        </section>

        <!-- Report Section -->
        <section id="report-section" class="hidden">
            <div class="page-header">
                <h1>学品教育学院</h1>
                <h2>高级数学 Fungsi Function</h2>
            </div>
            <div class="section-content">
                <div class="report-header">
                    <!-- 
                        重要提示：请将下面的 src="..." 中的 Base64 编码字符串
                        替换为您自己的学校Logo的Base64编码。
                        您可以使用任何在线工具（搜索“image to base64”）来转换您的Logo图片。
                    -->
                    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNNTAgMEMyMi4zOSAwIDAgMjIuMzkgMCA1MHMxMi41MiA0Ni4yMyAzMi40OCA0OS4zNGMuNDUuMDguNTItLjIuNTItLjQ0di0yLjU0YzAtMS4zMS0uNDktMi40Mi0xLjQ0LTMuMzMgMCAwLTguMzItLjQyLTguMzItOS4yNSAwLTIuMDQuNzMtMy43IDEuOTItNS4wMS0uMTktLjQ4LS44My0yLjM3LjE4LTQuOTYgMCAwIDEuNTgtLjUgNS4xNyAyLjA0QzQyLjU0IDI2LjA2IDQ1IDI2IDQ3LjQ4IDI2YzIuNDggMCA0Ljk0LjA2IDcuMzguMTggMy41OC0yLjU0IDUuMTctMi4wNCA1LjE3LTIuMDQgMS4wMSAyLjU5LjM3IDQuNDcuMTggNC45NiAxLjE5IDEuMzEgMS45MiAyLjk3IDEuOTIgNS4wMSAwIDguODUtOC4zMyA5LjI1LTguMzMgOS4yNS0uOTUuOTEgLTEuNDQgMi4wMiAtMS40NCAzLjMzdjQuMDRjMCAuMjQuMDcuNTMuNTIuNDRDODcuNDggOTYuMjMgMTAwIDc3LjYxIDEwMCA1MVM3Ny42MSAwIDUwIDB6IiBmaWxsPSIjMDBCN0YxIi8+PC9zdmc+" alt="Logo" class="logo">
                    <h3>成绩报告单 (Report Card)</h3>
                </div>
                <div id="summary" class="summary">
                    <div class="summary-item">
                        <h3>姓名 (Name)</h3>
                        <p id="report-name"></p>
                    </div>
                    <div class="summary-item">
                        <h3>得分 (Score)</h3>
                        <p id="report-score"></p>
                    </div>
                    <div class="summary-item">
                        <h3>正确率 (Accuracy)</h3>
                        <p id="report-accuracy"></p>
                    </div>
                    <div class="summary-item">
                        <h3>用时 (Time)</h3>
                        <p id="report-time"></p>
                    </div>
                </div>

                <h3>题目回顾 (Question Review)</h3>
                <div id="review-container"></div>
                
                <div id="share-section">
                    <p>复制下方链接分享您的成绩报告：</p>
                    <input type="text" id="share-link" readonly>
                    <button class="button" onclick="window.location.reload()">再试一次 (Try Again)</button>
                </div>
            </div>
        </section>

    </div>

    <script>
        const quizConfig = {
            totalQuestions: 10,
            topic: "高级数学 Fungsi Function",
        };

        const googleFormData = {
            formUrl: "https://docs.google.com/forms/d/e/1FAIpQLScE400-TL63-PS-mSzhm2P6pKBEYkcdeFcV05CuF9rNssAysA/formResponse",
            entryIds: {
                name: "entry.1734280046",
                branch: "entry.324392523",
                level: "entry.334192525",
                score: "entry.1197406020",
                accuracy: "entry.1909146688", // Note: The form seems to use the "topic" field for accuracy. Adjust if needed.
                topic: "entry.1909146688",
                reportLink: "entry.2063783972"
            }
        };

        const allQuestions = [
            // Extracted from images
            { question: "Diberi $f(x) = 2x + 9$, cari nilai bagi $f(5)$.<br>Given $f(x) = 2x + 9$, find the value of $f(5)$.", options: ["19", "16", "23", "14"], answer: 0 },
            { question: "Diberi $f(x) = \\frac{5x + 3}{2}$, cari nilai bagi $f(-3)$.<br>Given $f(x) = \\frac{5x + 3}{2}$, find the value of $f(-3)$.", options: ["-12", "-9", "-6", "6"], answer: 2 },
            { question: "Diberi $f(x) = \\frac{2x + 8}{3}$. Cari objek apabila imej ialah 3.<br>Given $f(x) = \\frac{2x + 8}{3}$. Find the object when the image is 3.", options: ["$1/2$", "1", "2", "$5/2$"], answer: 0 },
            { question: "Diberi $f(x) = 4 - 2x$ dan $g(x) = \\frac{x + 3}{2}$. Cari nilai $x$ dengan keadaan $f(x) = g(x)$.<br>Given $f(x) = 4 - 2x$ and $g(x) = \\frac{x + 3}{2}$. Find the value of $x$ such that $f(x) = g(x)$.", options: ["$5/3$", "1", "$3/5$", "2"], answer: 1 },
            { question: "Diberi $f(x) = x + 4$ dan $g(x) = 2x + 5$, cari fungsi gubahan $gf(x)$.<br>Given $f(x) = x + 4$ and $g(x) = 2x + 5$, find the composite function $gf(x)$.", options: ["$2x + 9$", "$2x + 13$", "$2x + 14$", "$x+9$"], answer: 1 },
            { question: "Diberi $g(x) = 5x + 1$, cari nilai bagi $g^2(2)$.<br>Given $g(x) = 5x + 1$, find the value of $g^2(2)$.", options: ["11", "56", "26", "121"], answer: 1 },
            { question: "Diberi $g(x) = 2x - 3$ dan $h(x) = 2x^2 + 2$, cari fungsi gubahan $hg(x)$.<br>Given $g(x) = 2x - 3$ and $h(x) = 2x^2 + 2$, find the composite function $hg(x)$.", options: ["$8x^2 - 24x + 20$", "$4x^2 - 12x + 10$", "$8x^2 - 20$", "$4x^2 + 1$"], answer: 0 },
            { question: "Diberi $f(x) = 5x - 2$ dan $g(x) = \\frac{4}{2x - 3}$, cari nilai bagi $gf(2)$.<br>Given $f(x) = 5x - 2$ and $g(x) = \\frac{4}{2x - 3}$, find the value of $gf(2)$.", options: ["8", "$4/13$", "1", "$4/7$"], answer: 1 },
            { question: "Diberi $f(x) = 5 - 8x$. Cari objek apabila imej ialah 6.<br>Given $f(x) = 5 - 8x$. Find the object when the image is 6.", options: ["$-1/8$", "1/8", "-1", "1"], answer: 0 },
            { question: "Diberi $f(x) = x + k$ dan $f(4) = 2$. Cari nilai $k$.<br>Given $f(x) = x + k$ and $f(4) = 2$. Find the value of $k$.", options: ["2", "-2", "6", "-6"], answer: 1 },
            { question: "Diberi $g(x) = \\frac{4}{x} - 7$. Cari objek apabila imej ialah -5.<br>Given $g(x) = \\frac{4}{x} - 7$. Find the object when the image is -5.", options: ["-2", "3", "-1", "2"], answer: 3 },
            // Generated Similar Questions
            { question: "Diberi $f(x) = 3x - 5$, cari nilai bagi $f(4)$.<br>Given $f(x) = 3x - 5$, find the value of $f(4)$.", options: ["7", "12", "17", "2"], answer: 0 },
            { question: "Diberi $f(x) = x^2 + 2x - 1$, cari nilai bagi $f(3)$.<br>Given $f(x) = x^2 + 2x - 1$, find the value of $f(3)$.", options: ["14", "8", "11", "16"], answer: 0 },
            { question: "Diberi $g(x) = \\frac{10}{x-3}$, cari nilai bagi $g(8)$.<br>Given $g(x) = \\frac{10}{x-3}$, find the value of $g(8)$.", options: ["5", "2", "10", "1"], answer: 1 },
            { question: "Diberi $h(x) = 7 - 4x$. Cari objek apabila imej ialah -1.<br>Given $h(x) = 7 - 4x$. Find the object when the image is -1.", options: ["2", "1.5", "-2", "8"], answer: 0 },
            { question: "Diberi $f(x) = 2x^2 - 10$. Cari objek positif apabila imej ialah 8.<br>Given $f(x) = 2x^2 - 10$. Find the positive object when the image is 8.", options: ["3", "9", "$\\sqrt{5}$", "4"], answer: 0 },
            { question: "Diberi $f(x) = x - 5$ dan $g(x) = 3x + 1$, cari fungsi gubahan $fg(x)$.<br>Given $f(x) = x - 5$ and $g(x) = 3x + 1$, find the composite function $fg(x)$.", options: ["$3x - 4$", "$3x - 14$", "$3x + 4$", "$x-4$"], answer: 0 },
            { question: "Diberi $f(x) = x^2$ dan $g(x) = x + 3$, cari fungsi gubahan $gf(x)$.<br>Given $f(x) = x^2$ and $g(x) = x + 3$, find the composite function $gf(x)$.", options: ["$x^2 + 3$", "$(x+3)^2$", "$x^2 + 9$", "$x+9$"], answer: 0 },
            { question: "Diberi $h(x) = 2x$ dan $k(x) = x - 7$, cari nilai bagi $hk(10)$.<br>Given $h(x) = 2x$ and $k(x) = x - 7$, find the value of $hk(10)$.", options: ["6", "13", "20", "3"], answer: 0 },
            { question: "Diberi $f(x) = \\frac{x+1}{2}$ dan $g(x) = 4x$. Cari nilai bagi $fg(2)$.<br>Given $f(x) = \\frac{x+1}{2}$ and $g(x) = 4x$. Find the value of $fg(2)$.", options: ["8", "4.5", "5", "9"], answer: 1 },
            { question: "Diberi $f(x) = 3x+k$ dan $f(2)=10$. Cari nilai $k$.<br>Given $f(x) = 3x+k$ and $f(2)=10$. Find the value of $k$.", options: ["4", "16", "8", "6"], answer: 0 },
            { question: "Diberi $g(x) = kx-5$ dan $g(3)=1$. Cari nilai $k$.<br>Given $g(x) = kx-5$ and $g(3)=1$. Find the value of $k$.", options: ["2", "-4/3", "6", "3"], answer: 0 },
            { question: "Diberi $f(x) = 2x+1$ dan $g(x) = x^2$. Cari nilai bagi $gf(3)$.<br>Given $f(x) = 2x+1$ and $g(x) = x^2$. Find the value of $gf(3)$.", options: ["49", "19", "13", "37"], answer: 0 },
            { question: "Diberi $f(x) = 5 - x$. Cari nilai bagi $f^2(2)$.<br>Given $f(x) = 5 - x$. Find the value of $f^2(2)$.", options: ["2", "3", "9", "6"], answer: 0 },
            { question: "Diberi $f(x) = 3x-2$. Cari $f^{-1}(x)$.<br>Given $f(x) = 3x-2$. Find $f^{-1}(x)$.", options: ["$\\frac{x+2}{3}$", "$\\frac{x-2}{3}$", "$3x+2$", "$2-3x$"], answer: 0 },
            { question: "Diberi $g(x) = \\frac{x}{2} + 5$. Cari $g^{-1}(x)$.<br>Given $g(x) = \\frac{x}{2} + 5$. Find $g^{-1}(x)$.", options: ["$2(x-5)$", "$2x-5$", "$\\frac{x-5}{2}$", "$2x+10$"], answer: 0 },
            { question: "Diberi $f(x)=2x$ dan $g(x)=x-3$. Selesaikan $fg(x) = 4$.<br>Given $f(x)=2x$ and $g(x)=x-3$. Solve $fg(x) = 4$.", options: ["5", "3.5", "1", "7"], answer: 0 },
            { question: "Diberi $f(x) = 6x+1$. Cari nilai $x$ jika $f(x) = 13$.<br>Given $f(x)=6x+1$. Find the value of $x$ if $f(x)=13$.", options: ["2", "12", "79", "2.33"], answer: 0 },
            { question: "Diberi $f(x)=x^2+3$. Cari nilai $f(-4)$.<br>Given $f(x)=x^2+3$. Find the value of $f(-4)$.", options: ["19", "-13", "13", "-5"], answer: 0 },
            { question: "Diberi $f(x) = \\frac{2x-1}{5}$. Cari $f^{-1}(3)$.<br>Given $f(x) = \\frac{2x-1}{5}$. Find $f^{-1}(3)$.", options: ["1", "8", "16", "2.5"], answer: 1 },
            { question: "Diberi $f(x)=x+1$ dan $g(x)=3x-4$. Cari $gf(x)$.<br>Given $f(x)=x+1$ and $g(x)=3x-4$. Find $gf(x)$.", options: ["$3x-1$", "$3x-3$", "$3x+3$", "$4x-3$"], answer: 0 },
            { question: "Diberi $f(x)=4-x$ dan $g(x)=2x$. Cari $fg(3)$.<br>Given $f(x)=4-x$ and $g(x)=2x$. Find $fg(3)$.", options: ["-2", "2", "6", "1"], answer: 0 },
            { question: "Diberi $h(x) = \\frac{6}{x}$. Cari $h^2(2)$.<br>Given $h(x) = \\frac{6}{x}$. Find $h^2(2)$.", options: ["2", "3", "6", "1.5"], answer: 0 },
            { question: "Diberi $f(x) = x^2 - 2x + 5$. Cari imej bagi 3.<br>Given $f(x) = x^2 - 2x + 5$. Find the image of 3.", options: ["8", "10", "2", "20"], answer: 0 },
            { question: "Diberi $g(x) = |2x - 7|$. Cari $g(3)$.<br>Given $g(x) = |2x - 7|$. Find $g(3)$.", options: ["1", "-1", "13", "-13"], answer: 0 },
            { question: "Diberi $f(x)=5x+2$. Fungsi $g(x)$ ditakrifkan sebagai $g(x)=f(x-1)$. Cari $g(x)$.<br>Given $f(x)=5x+2$. Function $g(x)$ is defined as $g(x)=f(x-1)$. Find $g(x)$.", options: ["$5x-3$", "$5x+1$", "$5x+2$", "$5x-5$"], answer: 0 },
            { question: "Diberi $f(x) = 2x-1$ dan $g(x) = x+3$. Selesaikan $f(x)=g(x)$.<br>Given $f(x)=2x-1$ and $g(x)=x+3$. Solve $f(x)=g(x)$.", options: ["4", "2", "-4", "2/3"], answer: 0 },
            { question: "Diberi $f:x \\rightarrow 3x+c$ dan $f(2)=5$. Cari nilai $c$.<br>Given $f:x \\rightarrow 3x+c$ and $f(2)=5$. Find the value of $c$.", options: ["-1", "1", "11", "3"], answer: 0 },
            { question: "Diberi $f(x)=ax-5$ dan $f(3)=7$. Cari nilai $a$.<br>Given $f(x)=ax-5$ and $f(3)=7$. Find the value of $a$.", options: ["4", "12", "2/3", "2"], answer: 0 },
            { question: "Diberi $f(x)=x^2+1$ dan $g(x)=2x$. Cari $fg(x)$.<br>Given $f(x)=x^2+1$ and $g(x)=2x$. Find $fg(x)$.", options: ["$4x^2+1$", "$2x^2+1$", "$2x^2+2$", "$4x^2+4x+1$"], answer: 0 },
            { question: "Diberi $f(x)=x-4$ dan $g(x)=3x$. Cari $gf(-1)$.<br>Given $f(x)=x-4$ and $g(x)=3x$. Find $gf(-1)$.", options: ["-15", "-5", "-9", "-7"], answer: 0 },
            { question: "Diberi $g(x)=1-2x$. Cari $g^2(x)$.<br>Given $g(x)=1-2x$. Find $g^2(x)$.", options: ["$4x-1$", "$1-4x$", "$4x+1$", "$4x^2-4x+1$"], answer: 0 },
            { question: "Diberi $f(x)=2x-5$. Cari objek bagi 11.<br>Given $f(x)=2x-5$. Find the object of 11.", options: ["8", "17", "3", "6"], answer: 0 },
            { question: "Diberi $f(x) = \\frac{x+5}{x-1}, x \\neq 1$. Cari $f(4)$.<br>Given $f(x) = \\frac{x+5}{x-1}, x \\neq 1$. Find $f(4)$.", options: ["3", "9", "1", "4/3"], answer: 0 },
            { question: "Diberi $f(x)=3x$ dan $g(x)=x-1$. Cari $f^{-1}g(4)$.<br>Given $f(x)=3x$ and $g(x)=x-1$. Find $f^{-1}g(4)$.", options: ["1", "3", "9", "11"], answer: 0 },
            { question: "Diberi $g(x)=2x+8$. Cari $g^{-1}(x)$.<br>Given $g(x)=2x+8$. Find $g^{-1}(x)$.", options: ["$\\frac{x-8}{2}$", "$\\frac{x}{2}-8$", "$2x-8$", "$\\frac{x+8}{2}$"], answer: 0 },
            { question: "Diberi $f(x)=10-x$. Selesaikan $f(k^2)=1$.<br>Given $f(x)=10-x$. Solve $f(k^2)=1$.", options: ["$\\pm 3$", "9", "3", "$\\pm 9$"], answer: 0 },
            { question: "Diberi $f(x)=x+5$ dan $g(x)=x^2-1$. Cari $gf(x)$.<br>Given $f(x)=x+5$ and $g(x)=x^2-1$. Find $gf(x)$.", options: ["$x^2+10x+24$", "$x^2+4$", "$(x+5)^2-1$", "$x^2+24$"], answer: 0 },
            { question: "Diberi $f(x)=2x+3$ dan $g(x)=x-2$. Cari $fg(x)$.<br>Given $f(x)=2x+3$ and $g(x)=x-2$. Find $fg(x)$.", options: ["$2x-1$", "$2x+1$", "$2x-4$", "$2x-7$"], answer: 0 },
            { question: "Diberi $f(x) = \\frac{x}{3}-1$. Cari $f(9)$.<br>Given $f(x) = \\frac{x}{3}-1$. Find $f(9)$.", options: ["2", "3", "8/3", "26/3"], answer: 0 },
            { question: "Diberi $g(x)=x^2+x$. Cari $g(-5)$.<br>Given $g(x)=x^2+x$. Find $g(-5)$.", options: ["20", "30", "-20", "-30"], answer: 0 },
            { question: "Diberi $f(x)=1-x$ dan $g(x)=x^2$. Cari $fg(-3)$.<br>Given $f(x)=1-x$ and $g(x)=x^2$. Find $fg(-3)$.", options: ["-8", "10", "16", "-2"], answer: 0 },
            { question: "Diberi $h(x) = \\frac{x-4}{2}$. Cari objek bagi 5.<br>Given $h(x) = \\frac{x-4}{2}$. Find the object of 5.", options: ["14", "6", "0.5", "3"], answer: 0 },
            { question: "Diberi $f(x) = 3x+1$. Cari $f^2(1)$.<br>Given $f(x) = 3x+1$. Find $f^2(1)$.", options: ["13", "4", "10", "7"], answer: 0 },
            { question: "Diberi $f(x)=ax+b$, $f(1)=5$ dan $f(2)=8$. Cari nilai $a$.<br>Given $f(x)=ax+b$, $f(1)=5$ and $f(2)=8$. Find the value of $a$.", options: ["3", "2", "5", "8"], answer: 0 },
            { question: "Diberi $f(x)=ax+b$, $f(1)=5$ dan $f(2)=8$. Cari nilai $b$.<br>Given $f(x)=ax+b$, $f(1)=5$ and $f(2)=8$. Find the value of $b$.", options: ["2", "3", "-3", "-2"], answer: 0 },
            { question: "Diberi $f(x)=4x-3$ dan $g(x)=2x+1$. Selesaikan $f(x)=g(x)$.<br>Given $f(x)=4x-3$ and $g(x)=2x+1$. Solve $f(x)=g(x)$.", options: ["2", "4", "-2", "-4/3"], answer: 0 },
            { question: "Diberi $f(x)=x^2-9$. Cari objek-objek bagi 0.<br>Given $f(x)=x^2-9$. Find the objects of 0.", options: ["$\\pm 3$", "3", "-3", "81"], answer: 0 },
            { question: "Diberi $f(x) = \\frac{3x+2}{4}$. Cari $f^{-1}(x)$.<br>Given $f(x) = \\frac{3x+2}{4}$. Find $f^{-1}(x)$.", options: ["$\\frac{4x-2}{3}$", "$\\frac{4x+2}{3}$", "$4x-2$", "$3x-4$"], answer: 0 },
            { question: "Diberi $f(x)=x$ dan $g(x)=3x^2-5$. Cari $gf(x)$.<br>Given $f(x)=x$ and $g(x)=3x^2-5$. Find $gf(x)$.", options: ["$3x^2-5$", "$3x-5$", "$(3x-5)^2$", "$x^2$"], answer: 0 },
            { question: "Diberi $f(x)=2x+1$. Cari nilai $m$ jika $f(m-1)=5$.<br>Given $f(x)=2x+1$. Find the value of $m$ if $f(m-1)=5$.", options: ["3", "2", "2.5", "4"], answer: 0 },
            { question: "Diberi $f(x)=|x-3|$. Cari $f(-2)$.<br>Given $f(x)=|x-3|$. Find $f(-2)$.", options: ["5", "-5", "1", "-1"], answer: 0 },
            { question: "Diberi $f(x) = 2x - 4$ dan $g(x) = \\frac{x}{2} + 2$. Cari $fg(x)$.<br>Given $f(x) = 2x - 4$ and $g(x) = \\frac{x}{2} + 2$. Find $fg(x)$.", options: ["$x$", "$x+4$", "$x-4$", "4"], answer: 0 },
            { question: "Diberi $f(x)=x^2+1$ dan $g(x)=x-1$. Cari $fg(2)$.<br>Given $f(x)=x^2+1$ and $g(x)=x-1$. Find $fg(2)$.", options: ["2", "5", "1", "4"], answer: 0 },
            { question: "Diberi $f(x) = 5x+p$ dan $f^{-1}(7)=1$. Cari nilai $p$.<br>Given $f(x) = 5x+p$ and $f^{-1}(7)=1$. Find the value of $p$.", options: ["2", "12", "-2", "7"], answer: 0 },
            { question: "Diberi $f(x)=x-2$ dan $g(x)=kx+1$. Diberi $gf(3)=7$. Cari nilai $k$.<br>Given $f(x)=x-2$ and $g(x)=kx+1$. Given $gf(3)=7$. Find the value of $k$.", options: ["6", "7", "3", "1"], answer: 0 },
            { question: "Diberi $f(x) = 2x$ dan $g(x) = x+3$. Cari $g^{-1}f(5)$.<br>Given $f(x) = 2x$ and $g(x) = x+3$. Find $g^{-1}f(5)$.", options: ["7", "10", "13", "4"], answer: 0 },
            { question: "Diberi $f(x)=4x-1$. Cari $f(x+1)$.<br>Given $f(x)=4x-1$. Find $f(x+1)$.", options: ["$4x+3$", "$4x$", "$4x-1$", "$4x+4$"], answer: 0 },
            { question: "Diberi $f(x)=x^2-1$. Cari $f(x-1)$.<br>Given $f(x)=x^2-1$. Find $f(x-1)$.", options: ["$x^2-2x$", "$x^2-2$", "$x^2-2x-2$", "$x^2$"], answer: 0 },
            { question: "Diberi $f(x)=3x-7$. Cari $x$ jika $f(x)=x$.<br>Given $f(x)=3x-7$. Find $x$ if $f(x)=x$.", options: ["3.5", "-3.5", "2", "-2"], answer: 0 },
            { question: "Diberi $f(x)=x+1$ dan $g(x)=x^2$. Cari $f(x)+g(x)$.<br>Given $f(x)=x+1$ and $g(x)=x^2$. Find $f(x)+g(x)$.", options: ["$x^2+x+1$", "$x^2+1$", "$(x+1)^2$", "$x^3+x^2$"], answer: 0 },
            { question: "Diberi $f(x)=2x$ dan $g(x)=x-5$. Cari $(fg)(3)$.<br>Given $f(x)=2x$ and $g(x)=x-5$. Find $(fg)(3)$.", options: ["-12", "6", "-2", "1"], answer: 0 },
            { question: "Diberi $f(x)=10/x$. Cari $f(5)$.<br>Given $f(x)=10/x$. Find $f(5)$.", options: ["2", "5", "0.5", "10"], answer: 0 },
            { question: "Diberi $f(x) = 2-x^2$. Cari $f(-3)$.<br>Given $f(x) = 2-x^2$. Find $f(-3)$.", options: ["-7", "11", "8", "-4"], answer: 0 },
            { question: "Diberi $f(x)=2x+1$ dan $fg(x)=2x+5$. Cari $g(x)$.<br>Given $f(x)=2x+1$ and $fg(x)=2x+5$. Find $g(x)$.", options: ["$x+2$", "$x+4$", "2", "$x+5$"], answer: 0 },
            { question: "Diberi $g(x)=x-3$ dan $fg(x)=2x-5$. Cari $f(x)$.<br>Given $g(x)=x-3$ and $fg(x)=2x-5$. Find $f(x)$.", options: ["$2x+1$", "$2x-11$", "$2x-2$", "$x-2$"], answer: 0 },
            { question: "Diberi $f(x) = 4-3x$. Cari $f^2(x)$.<br>Given $f(x) = 4-3x$. Find $f^2(x)$.", options: ["$9x-8$", "$8-9x$", "$16-9x^2$", "$1-3x$"], answer: 0 },
            { question: "Diberi $f(x)=x^2+4$. Cari julat $f(x)$ bagi domain $-1 \\le x \\le 2$.<br>Given $f(x)=x^2+4$. Find the range of $f(x)$ for the domain $-1 \\le x \\le 2$.", options: ["$4 \\le f(x) \\le 8$", "$5 \\le f(x) \\le 8$", "$4 \\le f(x) \\le 5$", "$0 \\le f(x) \\le 8$"], answer: 0 },
            { question: "Diberi $f(x)=x+1$ dan $g(x)=x^2$. Cari $g(f(x))$.<br>Given $f(x)=x+1$ and $g(x)=x^2$. Find $g(f(x))$.", options: ["$(x+1)^2$", "$x^2+1$", "$x^2+x$", "$x^2+2x+2$"], answer: 0 },
            { question: "Diberi $h(x)=3x-2$. Cari nilai $p$ jika $h(p+1)=p$.<br>Given $h(x)=3x-2$. Find the value of $p$ if $h(p+1)=p$.", options: ["$-1/2$", "$1/2$", "-1", "1"], answer: 0 },
            { question: "Diberi $f(x)=1/x$ dan $g(x)=x-1$. Cari $fg(x)$.<br>Given $f(x)=1/x$ and $g(x)=x-1$. Find $fg(x)$.", options: ["$1/(x-1)$", "$(1/x)-1$", "$x-1$", "$x$"], answer: 0 },
            { question: "Diberi $f(x)=2x-3$. Cari $f^{-1}(5)$.<br>Given $f(x)=2x-3$. Find $f^{-1}(5)$.", options: ["4", "7", "1", "1/7"], answer: 0 },
            { question: "Diberi $f(x)=x+2$ dan $g(x)=3$. Cari $fg(x)$.<br>Given $f(x)=x+2$ and $g(x)=3$. Find $fg(x)$.", options: ["5", "3", "$3x+2$", "x+5"], answer: 0 },
            { question: "Diberi $f(x)=2x+5$ dan $g(x)=x-2$. Cari $g^{-1}f(x)$.<br>Given $f(x)=2x+5$ and $g(x)=x-2$. Find $g^{-1}f(x)$.", options: ["$2x+7$", "$2x+3$", "$(2x+5)/-2$", "$x+7$"], answer: 0 },
            { question: "Diberi $f(x)=x^2$. Cari $f(x+h) - f(x)$.<br>Given $f(x)=x^2$. Find $f(x+h) - f(x)$.", options: ["$2xh+h^2$", "$h^2$", "$2x+h$", "$x^2+h^2$"], answer: 0 },
            { question: "Diberi $f(x)=3x$. Cari $f(2a)$.<br>Given $f(x)=3x$. Find $f(2a)$.", options: ["$6a$", "$32a$", "$3+2a$", "$5a$"], answer: 0 },
            { question: "Diberi $f(x) = 5x - 10$. Cari pintasan-x bagi graf $y=f(x)$.<br>Given $f(x) = 5x - 10$. Find the x-intercept of the graph $y=f(x)$.", options: ["2", "-10", "-2", "10"], answer: 0 },
            { question: "Diberi $f(x) = 2x+1$ dan $g(x) = 3x$. Cari $g(f(2))$.<br>Given $f(x)=2x+1$ and $g(x)=3x$. Find $g(f(2))$.", options: ["15", "5", "12", "7"], answer: 0 },
            { question: "Diberi $f(x) = \\frac{1}{x+1}$. Cari domain bagi $f(x)$.<br>Given $f(x) = \\frac{1}{x+1}$. Find the domain of $f(x)$.", options: ["Semua nombor nyata kecuali -1", "Semua nombor nyata kecuali 1", "Semua nombor nyata", "$x > -1$"], answer: 0 },
            { question: "Diberi $g(x)=x^3$. Cari $g(-2)$.<br>Given $g(x)=x^3$. Find $g(-2)$.", options: ["-8", "8", "-6", "6"], answer: 0 },
            { question: "Diberi $f(x)=x+2$ dan $g(x)=x-2$. Cari $f(g(x))$.<br>Given $f(x)=x+2$ and $g(x)=x-2$. Find $f(g(x))$.", options: ["$x$", "$x-4$", "$x+4$", "0"], answer: 0 },
            { question: "Diberi $f(x) = 2^x$. Cari $f(3)$.<br>Given $f(x) = 2^x$. Find $f(3)$.", options: ["8", "6", "9", "5"], answer: 0 },
        ];
        
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = [];
        let studentInfo = {};
        
        let timerInterval;
        let seconds = 0;

        function startTimer() {
            seconds = 0;
            const timerEl = document.getElementById('timer');
            timerEl.textContent = '00:00';
            timerInterval = setInterval(() => {
                seconds++;
                const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
                const secs = (seconds % 60).toString().padStart(2, '0');
                timerEl.textContent = `${mins}:${secs}`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startQuiz() {
            studentInfo.name = document.getElementById('student-name').value;
            studentInfo.branch = document.getElementById('student-branch').value;
            studentInfo.level = document.getElementById('student-level').value;

            if (!studentInfo.name || !studentInfo.branch || !studentInfo.level) {
                alert('请填写所有学生信息 (Please fill in all student information)');
                return;
            }

            document.getElementById('student-info').classList.add('hidden');
            document.getElementById('quiz-section').classList.remove('hidden');
            
            currentQuestions = shuffleArray([...allQuestions]).slice(0, quizConfig.totalQuestions);
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = [];

            loadQuestion();
            startTimer();
        }
        
        function loadQuestion() {
            if (currentQuestionIndex >= currentQuestions.length) {
                endQuiz();
                return;
            }

            const questionData = currentQuestions[currentQuestionIndex];
            document.getElementById('question-counter').textContent = `Soalan (Question) ${currentQuestionIndex + 1} / ${currentQuestions.length}`;
            document.getElementById('question-container').innerHTML = questionData.question;
            
            const optionsGrid = document.getElementById('options-grid');
            optionsGrid.innerHTML = '';
            
            questionData.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.innerHTML = option;
                button.onclick = () => selectAnswer(index);
                optionsGrid.appendChild(button);
            });
            
            document.getElementById('feedback').textContent = '';
            
            // Re-render MathJax for the new content
            if (window.MathJax) {
                MathJax.typesetPromise();
            }
        }
        
        function selectAnswer(selectedIndex) {
            const questionData = currentQuestions[currentQuestionIndex];
            const isCorrect = selectedIndex === questionData.answer;
            
            userAnswers.push({
                question: questionData.question,
                options: questionData.options,
                correctAnswerIndex: questionData.answer,
                selectedIndex: selectedIndex,
                isCorrect: isCorrect
            });

            if (isCorrect) {
                score++;
                document.getElementById('feedback').textContent = 'Betul! (Correct!)';
                document.getElementById('feedback').style.color = 'var(--correct-color)';
            } else {
                document.getElementById('feedback').textContent = 'Salah. (Incorrect.)';
                document.getElementById('feedback').style.color = 'var(--incorrect-color)';
            }
            
            const optionButtons = document.querySelectorAll('.option-btn');
            optionButtons.forEach((btn, index) => {
                btn.classList.add('disabled');
                if (index === questionData.answer) {
                    btn.classList.add('correct');
                }
                if (index === selectedIndex && !isCorrect) {
                    btn.classList.add('incorrect');
                }
            });

            currentQuestionIndex++;
            setTimeout(loadQuestion, 1500);
        }

        async function endQuiz() {
            stopTimer();
            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('report-section').classList.remove('hidden');
            
            await generateReport();
            submitToGoogleForm();
        }

        function generateReport() {
            return new Promise(resolve => {
                document.getElementById('report-name').textContent = studentInfo.name;
                const finalScore = `${score}/${currentQuestions.length}`;
                document.getElementById('report-score').textContent = finalScore;
                const accuracy = ((score / currentQuestions.length) * 100).toFixed(0) + '%';
                document.getElementById('report-accuracy').textContent = accuracy;
                document.getElementById('report-time').textContent = document.getElementById('timer').textContent;

                const reviewContainer = document.getElementById('review-container');
                reviewContainer.innerHTML = '';
                userAnswers.forEach((answer, index) => {
                    const reviewItem = document.createElement('div');
                    reviewItem.className = 'review-item';
                    
                    const yourAnswerText = answer.isCorrect 
                        ? `<span class="your-answer correct">Jawapan anda (Your answer): ${answer.options[answer.selectedIndex]} (Betul / Correct)</span>`
                        : `<span class="your-answer incorrect">Jawapan anda (Your answer): ${answer.options[answer.selectedIndex]} (Salah / Incorrect)</span><br><span class="correct-answer">Jawapan tepat (Correct Answer): ${answer.options[answer.correctAnswerIndex]}</span>`;

                    reviewItem.innerHTML = `
                        <p><b>${index + 1}.</b> ${answer.question}</p>
                        <p>${yourAnswerText}</p>
                    `;
                    reviewContainer.appendChild(reviewItem);
                });

                // Generate and display shareable link
                const reportData = {
                    name: studentInfo.name,
                    score: finalScore,
                    accuracy: accuracy,
                    time: document.getElementById('timer').textContent,
                    topic: quizConfig.topic,
                    answers: userAnswers
                };
                
                const compressedData = compressData(reportData);
                const shareableLink = `${window.location.origin}${window.location.pathname}?data=${compressedData}`;
                const shareLinkInput = document.getElementById('share-link');
                shareLinkInput.value = shareableLink;
                shareLinkInput.onclick = () => shareLinkInput.select();

                if (window.MathJax) {
                    MathJax.typesetPromise().then(resolve);
                } else {
                    resolve();
                }
            });
        }
        
        function submitToGoogleForm() {
            const formData = new FormData();
            formData.append(googleFormData.entryIds.name, studentInfo.name);
            formData.append(googleFormData.entryIds.branch, studentInfo.branch);
            formData.append(googleFormData.entryIds.level, studentInfo.level);
            formData.append(googleFormData.entryIds.score, `${score}/${currentQuestions.length}`);
            formData.append(googleFormData.entryIds.accuracy, ((score / currentQuestions.length) * 100).toFixed(0) + '%');
            formData.append(googleFormData.entryIds.topic, quizConfig.topic);
            formData.append(googleFormData.entryIds.reportLink, document.getElementById('share-link').value);

            fetch(googleFormData.formUrl, {
                method: 'POST',
                body: formData,
                mode: 'no-cors'
            }).catch(error => console.error('Error submitting to Google Form:', error));
        }
        
        function compressData(data) {
            const jsonString = JSON.stringify(data);
            const compressed = pako.gzip(jsonString, { to: 'string' });
            return btoa(compressed);
        }

        function decompressData(base64String) {
            try {
                const compressed = atob(base64String);
                const jsonString = pako.ungzip(compressed, { to: 'string' });
                return JSON.parse(jsonString);
            } catch (e) {
                console.error("Failed to decompress or parse data", e);
                return null;
            }
        }
        
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const data = urlParams.get('data');

            if (data) {
                const reportData = decompressData(data);
                if (reportData) {
                    studentInfo.name = reportData.name;
                    score = reportData.answers.filter(a => a.isCorrect).length;
                    currentQuestions = reportData.answers.map(a => ({
                        question: a.question,
                        options: a.options,
                        answer: a.correctAnswerIndex
                    }));
                    userAnswers = reportData.answers;
                    
                    document.getElementById('student-info').classList.add('hidden');
                    document.getElementById('quiz-section').classList.add('hidden');
                    document.getElementById('report-section').classList.remove('hidden');

                    document.getElementById('report-name').textContent = reportData.name;
                    document.getElementById('report-score').textContent = reportData.score;
                    document.getElementById('report-accuracy').textContent = reportData.accuracy;
                    document.getElementById('report-time').textContent = reportData.time;
                    document.querySelector('#report-section .page-header h2').textContent = reportData.topic;
                    
                    const reviewContainer = document.getElementById('review-container');
                    reviewContainer.innerHTML = '';
                    userAnswers.forEach((answer, index) => {
                        const reviewItem = document.createElement('div');
                        reviewItem.className = 'review-item';
                        const yourAnswerText = answer.isCorrect 
                            ? `<span class="your-answer correct">Jawapan anda (Your answer): ${answer.options[answer.selectedIndex]} (Betul / Correct)</span>`
                            : `<span class="your-answer incorrect">Jawapan anda (Your answer): ${answer.options[answer.selectedIndex]} (Salah / Incorrect)</span><br><span class="correct-answer">Jawapan tepat (Correct Answer): ${answer.options[answer.correctAnswerIndex]}</span>`;

                        reviewItem.innerHTML = `
                            <p><b>${index + 1}.</b> ${answer.question}</p>
                            <p>${yourAnswerText}</p>
                        `;
                        reviewContainer.appendChild(reviewItem);
                    });
                    
                    document.getElementById('share-section').innerHTML = '<button class="button" onclick="window.location.href=window.location.pathname">进行新的测验 (Start New Quiz)</button>';

                    if (window.MathJax) {
                        MathJax.typesetPromise();
                    }
                }
            }
        };

    </script>
</body>
</html>
